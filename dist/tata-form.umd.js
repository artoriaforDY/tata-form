(function(u,n){typeof exports=="object"&&typeof module<"u"?n(exports,require("vue"),require("element-plus")):typeof define=="function"&&define.amd?define(["exports","vue","element-plus"],n):(u=typeof globalThis<"u"?globalThis:u||self,n(u.TataForm={},u.Vue,u.ElementPlus))})(this,function(u,n,i){"use strict";const p=e=>({form:i.ElForm,"form-item":i.ElFormItem,input:i.ElInput,"input-number":i.ElInputNumber,autocomplete:i.ElAutocomplete,select:i.ElSelect,option:i.ElOption,"select-v2":i.ElSelectV2,"tree-select":i.ElTreeSelect,"checkbox-group":i.ElCheckboxGroup,checkbox:i.ElCheckbox,"radio-group":i.ElRadioGroup,radio:i.ElRadio,"radio-button":i.ElRadioButton,"date-picker":i.ElDatePicker,"time-picker":i.ElTimePicker,"time-select":i.ElTimeSelect,cascader:i.ElCascader,slider:i.ElSlider,switch:i.ElSwitch})[e],g=n.defineComponent({name:"TataForm",props:{formList:{type:Array,required:!0},options:{type:Object,required:!0},grid:{type:[Array,Number]},labelWidth:{type:Number,default:100},contentWidth:{type:[Number,String],default:240},clearable:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1}},data(){return{form:this.initForm(),refObj:{}}},computed:{rules(){let e={};return this.formList.forEach(t=>{this.isRequired(t)&&(e[t.key]=t.rule)}),e}},methods:{initForm(e){if(console.log("执行了initForm"),!Array.isArray(this.formList))return console.error("formList must be an array"),{};let t={},s={input:"","input-number":0,autocomplete:"",select:null,"select-v2":null,"tree-select":null,"checkbox-group":[],"radio-group":"",date:"",datetime:"",daterange:[],datetimerange:[],"time-select":"",cascader:[],slider:0,switch:!1};return this.formList.forEach(o=>{let r=o.defaultValue!==void 0?o.defaultValue:s[o.type];if(o.key){let f=typeof o.disabled=="function"?o.disabled(this.form,o):o.disabled;t[o.key]=e&&f?t[o.key]:r}}),console.log("form===>",t),t},generateTag({item:e,tagName:t,tagType:s,options:o}){let r=typeof e.disabled=="function"?e.disabled(this.form,o):e.disabled,f={"model-value":this.form[e.key],...e.props||{},disabled:this.disabled||r},d=e.attrs||{},h=e.on||{},l={...f,...d,key:e.key,style:{}};e.width&&(l.style.width=typeof w=="string"?w:w+"px"),o&&(s==="tree-select"?l.data=o:["checkbox-group","radio-group","select"].includes(s)||(l.options=o)),s==="input"?l.onInput=a=>{console.log("input",a),e.ref&&(this.refObj[e.ref]=this.$refs[e.ref]),this.form[e.key]=a,this.emitInput(a,e,this.refObj)}:l.onChange=a=>{console.log("input",a),a=this.formatDateValue(a,e),e.ref&&(this.refObj[e.ref]=this.$refs[e.ref]),this.form[e.key]=a,this.emitInput(a,e,this.refObj)};for(let a in h){const b=m=>(...F)=>{m(...F,e,this.form)};l[a]=b(h[a])}return e.hasOwnProperty("ref")&&(l.ref=e.ref),["select-v2","tree-select","cascader"].includes(e.type)?n.h(t,l):n.h(t,l,o)},formatDateValue(e,t){return["date","datetime"].includes(t.type)?e||"":["daterange","datetimerange"].includes(t.type)?e||["",""]:(console.log("formatDateValue",e),e)},emitInput(e,t,s){typeof t.onInput=="function"&&t.onInput(e,t,this.form,s)},async submit(){const e=await this.$refs.form.validate();this.$emit("submit",this.getForm(),e,this.$refs)},reset(e){this.clear(),this.form=this.initForm(e),this.$refs.form.resetFields()},clear(e){this.$refs.form.clearValidate&&this.$refs.form.clearValidate(e||void 0)},getFormBykey(e){return this.form[e]},getForm(){return{...this.form}},setForm(e){for(let t in e)this.form[t]=e[t]},validateField(e,t){return this.$refs.form.validateField(e,t)},renderFormList(e){const t=this.grid;return typeof t=="number"?this.getFormListByNumber(e):Array.isArray(t)?this.getFormListByArray(e):this.getFormList(e)},getFormList(e){return this.formList.map(t=>this.getFormItem(t,this.getContent(t)))},getFormListByNumber(e){let t=[],s=~~Math.abs(this.grid);s<1&&(s=1);let o=this.formList.filter(r=>{let f=typeof r.isShow=="function"?r.isShow(this.form,r):r.hasOwnProperty("isShow")?!!r.isShow:!0,d=typeof r.hasRow=="function"?r.hasRow(this.form,r):r.hasOwnProperty("hasRow")?!!r.hasRow:!0;return!(!f&&!d)});for(let r=0;r<o.length;r+=s){let f=[];for(let h=0;h<s&&r+h<o.length;h++){let l=o[r+h];if(!l)break;let c=this.getFormItem(l,this.getContent(l)),y=e(p("col"),{span:24/s},[c]);f.push(y)}let d=this.getRow(f);t.push(d)}return t},getFormListByArray(e){let t=[],s=0,o=this.formList.filter(r=>{let f=typeof r.isShow=="function"?r.isShow(this.form,r):r.hasOwnProperty("isShow")?!!r.isShow:!0,d=typeof r.hasRow=="function"?r.hasRow(this.form,r):r.hasOwnProperty("hasRow")?!!r.hasRow:!0;return!(!f&&!d)});for(let r=0;r<o.length;){let f=[],d=this.grid[s];for(let l=0;l<d;l++){let c=o[r+l];if(!c)break;let y=this.getFormItem(c,this.getContent(c)),a=e(p("col"),{span:24/d},[y]);f.push(a)}let h=this.getRow(f);t.push(h),s+=1,r+=d}return t},getRow(e){return n.h(p("row"),e)},getContent(e){let t;return typeof e.renderContent=="function"?t=e.renderContent(n.h,e,this.form):t=this.renderTagByName(e,e.type),t},getFormItem(e,t){if(e.isShow!==!1&&!(typeof e.isShow=="function"&&e.isShow(this.form,e)===!1)){if(typeof e.render=="function")return e.render(n.h,e,this.form);{let s=this.contentWidth,o={prop:e.key,label:e.title,style:{width:typeof s=="string"?s:s+"px"},...e.settings};return n.h(p("form-item"),o,{label:()=>this.renderTitle(n.h,e,this.form),default:()=>[t]})}}},isRequired(e){return e.rule?Array.isArray(e.rule)?e.rule.some(t=>t.required):e.rule.required:!1},renderTitle(e,t){if(t.renderTitle){let s=this.isRequired(t)?e("span",{style:"color: red"},"*"):"",o=typeof t.renderTitle=="function"?t.renderTitle(e,t,this.form):t.title;return e("span",[s,o])}else return t.title?e("span",[t.title]):""},renderTagByName(e){const t=["select","checkbox-group","radio-group"],s=["select-v2","tree-select","cascader"];let o={item:e,tagType:e.type,tagName:p(e.type)};return t.includes(e.type)?o.options=this.renderTagChildren(e):s.includes(e.type)&&(o.options=e.options||[]),this.generateTag(o)},renderTagChildren(e){let t=o=>({label:o.text,value:o.value,disabled:o.disabled}),s=[];switch(e.type){case"select":s=e.options.map(r=>n.h(p("option"),{...t(r)},typeof e.renderOption=="function"?[e.renderOption(n.h,r,e)]:""));break;case"checkbox-group":s=e.options.map(r=>n.h(p("checkbox"),{...t(r)},typeof e.renderOption=="function"?[e.renderOption(n.h,r,e)]:""));break;case"radio-group":const o=e.props||{};s=e.options.map(r=>n.h(p(o!=null&&o.radioButton?"radio-button":"radio"),{...t(r)},typeof e.renderOption=="function"?[e.renderOption(n.h,r,e)]:""));break}return s}},render(){return console.log("执行了render"),n.h(i.ElForm,{model:this.form,"label-width":typeof this.labelWidth=="string"?this.labelWidth:this.labelWidth+"px",...this.options,rules:this.rules,ref:"form",nativeOn:{submit(e){e.preventDefault(),e.stopPropagation()}}},()=>{var e,t;return[this.renderFormList(n.h),(t=(e=this.$slots).default)==null?void 0:t.call(e)]})}});u.TataForm=g,Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});
